<!DOCTYPE html>
<html lang="en">
<head>
    <meta name=viewport content="width=device-width,initial-scale=1">
    <meta charset="utf-8">
    <title id="title">Formular Geometry</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script src="https://www.geogebra.org/apps/deployggb.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.23/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="https://opyshna.github.io/Formular_geometry/favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        body {
            display: flex;
            flex-flow: column;
            width: 100vw;
            height: 100vh;
        }
        .full_width, .explanation, .drawer, .drawer-content, #navbar {
            min-width: 0;
            min-height: 0;
        }
        .full_width {
            flex: 1 1 auto;
            display: flex;
        }
        .half_width {
            flex: 0 0 50%;
        }
        @media (max-width: 100vh) {
            .full_width {
                flex-flow: column;
            }
            .explanation {
                order: 2;
            }
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .explanation {
            flex: 1 1 auto;
            overflow-y: auto;
        }
        #solution-steps {
            overflow: hidden;
            margin: 0;
            max-height: 0;
            transition: max-height 0.3s cubic-bezier(0.2, 1, 0.1, 1);
        }
        #navbar {
            box-shadow: 0 0 1px black;
            padding-top: 2px;
            padding-left: 2px;
            padding-bottom: 2px;
        }
        .sidebar-menu-rating {
            position: absolute;
            right: .75rem;
            top: 0;
            bottom: 0;
            display: flex;
            align-items: center;
        }
        .sidebar-menu-rating > div {
            --tw-bg-opacity: 1;
            background-color: rgb(251 146 60/var(--tw-bg-opacity));
            height: 1rem;
            width: 1rem;
        }
        #task-container > div:not(.join, #solution-steps), #solution-steps > div {
            padding: 10px;
        }
        #ss-control {
            padding-left: 10px;
        }
        #task-container > div > b {
            margin-right: 5px;
        }
        #editGGBbtn {
            top: 1px;
            right: calc(3px + 3rem);
            transition: 0.3s cubic-bezier(0.2, 1, 0.1, 1);
        }
        #editGGBbtn.btn-active {
            right: 1px;
            z-index: 101;
        }
    </style>
    <script>
        {
        var defaultMenuItem = {
            name: "_error_",
            link: "",
            difficulty: -1,
            image: ""
        };
        let ABM_A = { // Vernik 2
            name: "ABM_A",
            task: "tasks/Vernik/ABM_A",
            difficulty: 0,
            image: ""
        };
        let ABH = { // Vernik 7
            name: "ABH",
            task: "tasks/Vernik/ABH",
            difficulty: 1,
            image: ""
        };
        var menuList = [ABM_A, ABH];
        var menuTree = [
            {catName:"Triangle reconstruction", items:[ABM_A, ABH]}
        ];
        }
    </script>
</head>
<body>
<div class="drawer flex flex-1">
<input id="my-drawer" type="checkbox" class="drawer-toggle" />
<div class="drawer-content flex flex-col flex-1">
    <div class="navbar bg-base-100" id="navbar">
        <div class="flex-none">
            <label for="my-drawer" class="btn btn-square btn-ghost drawer-button" onclick="toggleGGTools(1);">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </label>
        </div>
        <div class="flex-1">
            <a class="btn btn-ghost text-xl no-animation" id="menuTitle">Formular Geometry</a>
        </div>
        <div class="flex-none">
            <div class="form-control">
                <label class="label cursor-pointer">
                    <span class="label-text">ðŸŽ‰&nbsp;</span>
                    <input type="checkbox" class="toggle" id="confetti-checkbox" onchange="toggleConfetti(this,event);"/>
                </label>
            </div>
            <label class="cursor-pointer grid place-items-center">
                <input type="checkbox" value="synthwave" class="toggle theme-controller bg-base-content row-start-1 col-start-1 col-span-2" style="color: var(--fallback-bc,oklch(var(--bc)/var(--tw-text-opacity)));"/>
                <svg class="col-start-1 row-start-1 stroke-base-100 fill-base-100" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/></svg>
                <svg class="col-start-2 row-start-1 stroke-base-100 fill-base-100" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </label>
        </div>
    </div>

    <div class="full_width">
        <div class="half_width explanation">
            <div class="flex-col" id="task-container">

                <!--<div><b>Task:</b>reconstruct the triangle by points $A$, $B$ and $M_A$</div>
                <div class="flex"><b>Given:</b><div class="flex-col">
                <div>$A$, $B$ - two vertices of the triangle</div>
                <div>$M_A$ - base of the median of the triangle from $A$</div>
                </div></div>
                <div class="flex-col" id="solution-steps" task-name="ABH" initial-command=
                "A=(2,1)\nB=(0,-1)\nM_A=(0,0)
                BM_A=Ray(B,M_A)
                c=Circle(M_A,B)
                C=2M_A-B
                ABC=Polygon(A,B,C)">
                <div objs="BM_A">1. $BM_A$</div>
                <div objs="c">2. $||M_AC||=||M_AB||$</div>
                <div objs="C">3. $C=BM_Aâ‹‚C$</div>
                <div objs="ABC">4. $Î”ABC$</div>
                </div>-->

                <div class="join" id="ss-control">
                    <buttton onclick="prevGG()" class="btn join-item"><div class="ssLoading" style="position: relative;"><span style="visibility: hidden;">PREV</span><span class="loading loading-spinner loading-xs"></span></div></buttton>
                    <buttton onclick="nextGG()" class="btn join-item"><div class="ssLoading" style="position: relative;"><span style="visibility: hidden;" id="confetti-source">NEXT</span><span class="loading loading-spinner loading-xs"></span></div></buttton>
                    <button class="btn btn-square join-item" onmousedown="ssMouseDown(event.clientY);event.preventDefault();" ontouchstart="ssMouseDown(event.touches[0].clientY);event.preventDefault();" style="touch-action:none;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="half_width" id="ggb-wrapper">
            <div style="position:relative;width:fit-content;height:fit-content;">
                <div id="ggb-element"></div>
                <span class="loading loading-spinner loading-lg" id="ggb-loading"></span>
                <button class="btn btn-square" onclick="appletOnClear();this.children[0].style.transform+='rotate(180deg)'" fill="none" style="position:absolute;top:1px;right:1px">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current" style="transition: .5s cubic-bezier(0.175, 0.885, 0.32, 1.275);"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 12h4l-2 -3.46zh2v-3 M18 12h4l-2 3.46zh2v3 M4 12A8 8 0 0 0 17.66 17.66 M20 12A8 8 0 0 0 6.34 6.34"></path></svg>
                </button>
                <button class="btn btn-square" id="editGGBbtn" onclick="toggleGGTools()" fill="none" style="position:absolute;">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 22l 4 -1 l 12 -12 l -3 -3 l -12 12z m18 -15l2 -2l-3 -3l-2 2z"></path></svg>
                </button>
            </div>
        </div>


        <script>
            function fixGGB() {
                if (!GGapp) return;
                document.getElementById("ggb-wrapper").style.overflow="hidden";
                //document.getElementsByClassName("ggbTransform")[0].style.transform='';
                GGapp.setWidth(document.getElementById("ggb-wrapper").offsetWidth);
                GGapp.setHeight(document.getElementById("ggb-wrapper").offsetHeight);
            }
            window.addEventListener("resize", fixGGB);
            GGapp = undefined;
            stepsLoaded = false;
            confettiLaunched = false;
            if (!localStorage.getItem('confettiState')) localStorage.setItem('confettiState', '2');
            cc = 0;
            animSpeed = 200; // px/s
            function getStepsHeights() {
                heights = [0];
                steps = document.getElementById("solution-steps").children;
                for (var i = 0; i < steps.length; i++) heights.push(steps[i].offsetHeight + heights[i]);
                return heights;
            }
            function getConfetti() {
                confettiState = localStorage.getItem('confettiState');
                if ((confettiLaunched && confettiState != '3') || confettiState == '1' || (ssMove.moving && ssMove.confettiLaunched)) return;
                rect = document.getElementById("confetti-source").getBoundingClientRect();
                confetti({
                        // https://github.com/catdad/canvas-confetti?tab=readme-ov-file#options
                                particleCount: 20,
                                startVelocity: 20,
                                ticks: 50,
                                origin: {x:(rect.x+rect.width/2)/window.innerWidth, y:(rect.y+rect.height/2)/window.innerHeight},
                                disableForReducedMotion: true
                });
                confettiLaunched = true;
                ssMove.confettiLaunched = true;
            }
            function nextGG() {
                ss = document.getElementById("solution-steps");
                if (!stepsLoaded || ss.children.length <= cc) return;
                if (GGapp) for (obj of ss.children[cc].getAttribute("objs").split(" ")) GGapp.setVisible(obj, true);
                h2 = getStepsHeights()[cc+1];
                ss.style.maxHeight = h2 + "px";
                cc += 1;
                if (cc == ss.children.length) getConfetti();
            }
            function prevGG() {
                if (!stepsLoaded || cc <= 0) return;
                cc -= 1;
                ss = document.getElementById("solution-steps");
                if (GGapp) for (obj of ss.children[cc].getAttribute("objs").split(" ")) GGapp.setVisible(obj, false);
                h2 = getStepsHeights()[cc];
                ss.style.maxHeight = h2 + "px";
            }
            ssMove = {}
            function ssMouseDown(y) {
                if (!stepsLoaded) return;
                ssMove.heights = getStepsHeights();
                ss = document.getElementById("solution-steps");
                h0 = ss.offsetHeight;
                ss.style.maxHeight = ss.offsetHeight + "px";
                ss.style.transition = "none";
                rect = ss.getBoundingClientRect();
                ssMove.startY = y-rect["top"]-h0;
                ssMove.moving = true;
            }
            function ssMouseMove(y, bl) {
                if (!stepsLoaded || !ssMove.moving) return;
                if (!bl) {
                    ssMouseUp();
                    return;
                }
                ss = document.getElementById("solution-steps");
                rect = ss.getBoundingClientRect();
                h1 = Math.max(0, y-rect["top"]-ssMove.startY);
                ss.style.maxHeight = h1 + "px";
                cc1 = 0;
                for (var i = 0; i < ss.children.length; i++) {
                    mid = (heights[i]+heights[i+1])/2;
                    shouldShow = h1>mid;
                    if (GGapp) for (obj of ss.children[i].getAttribute("objs").split(" ")) GGapp.setVisible(obj, shouldShow);
                    if (shouldShow) cc1 = i+1;
                }
                cc = cc1;
                if (cc == ss.children.length) getConfetti();
                else ssMove.confettiLaunched = false;
            }
            function ssMouseUp() {
                if (!stepsLoaded || !ssMove.moving) return;
                ss = document.getElementById("solution-steps");
                ss.style.transition = "";
                h0 = ss.offsetHeight;
                h2 = getStepsHeights()[cc];
                ss.style.maxHeight = h2 + "px";
                ssMove.moving = false;
            }
            window.addEventListener("mousemove", (event)=>ssMouseMove(event.clientY, event.buttons & 1));
            window.addEventListener("mouseup", ssMouseUp);
            document.body.addEventListener("touchstart", ()=>{})
            window.addEventListener("touchmove", (event)=>ssMouseMove(event.touches[0].clientY, true));
            window.addEventListener("touchend", ssMouseUp);
            window.addEventListener("touchcancel", ssMouseUp);
            loadedSteps = [];
            function loadSteps() {
                url = new URL(window.location.href);
                task = url.searchParams.get("task");
                sc = document.getElementById("task-container");
                if (task) {
                    ifrm = document.createElement("iframe");
                    ifrm.setAttribute("onload", "stepsOnLoadIfrm(this);");
                    ifrm.setAttribute("src", task);
                    ifrm.style.display = "none";
                    sc.insertBefore(ifrm, sc.firstChild);
                } else {
                    loadedSteps = document.createElement("div");
                    loadedSteps.innerHTML = "Please select a task in the sidebar";
                    sc.insertBefore(loadedSteps, sc.firstChild);
                    document.getElementById("ss-control").style.visibility="hidden";
                    document.getElementById("my-drawer").checked=true;
                }
            }
            function stepsOnLoadIfrm(ifrm) {
                if (loadedSteps.length) {
                    for (el of loadedSteps) el.remove();
                    if (GGapp) GGapp.reset();
                }
                sc = document.getElementById("task-container");
                div = document.createElement('div');
                div.innerHTML = (ifrm.contentDocument.body||ifrm.contentDocument).innerHTML;
                l = div.children.length;
                for (var i = 0; i < l; i++) {
                    loadedSteps.push(div.children[0]);
                    insertChildAtIndex(sc, div.children[0], i);
                }
                ifrm.remove();
                div.offsetHeight;
                stepsOnLoad();
            }
            function stepsOnLoad() {
                MathJax.Hub.Typeset()
                title = document.getElementById("title");
                title.innerHTML = document.getElementById("solution-steps").getAttribute("task-name") + " - " + title.innerHTML;
                for (el of document.getElementsByClassName("ssLoading")) {
                    el.children[0].style.visibility="";
                    el.children[1].style.display="none";
                }
                stepsLoaded = true;
                problemOnLoad();
            }
            function appletOnClear() {
                if (GGapp && stepsLoaded) {
                    GGapp.reset();
                    appletOnLoad(GGapp);
                }
            }
            function problemOnLoad() {
                if (!stepsLoaded || !GGapp) return;
                ss = document.getElementById("solution-steps");
                GGapp.evalCommand(ss.getAttribute("initial-command").replaceAll("\\n", "\n"));
                for (var i = cc; i < ss.children.length; i++) for (obj of ss.children[i].getAttribute("objs").split(" ")) GGapp.setVisible(obj, false);
                ss.offsetHeight;
                MathJax.Hub.Typeset()
            }
            function toggleGGTools(forceOff) {
                if (!GGapp) return;
                btn = document.getElementById("editGGBbtn");
                editOn = btn.classList.toggle("btn-active");
                if (editOn && forceOff) editOn = btn.classList.toggle("btn-active");
                GGapp.showToolBar(editOn);
                GGapp.enableRightClick(editOn);
                if (!editOn) GGapp.setMode(0);
            }
            function appletOnLoad(app) {
                GGapp = app;
                GGapp.setCustomToolBar("0 73 62 6 | 1 501 67 5 19 72 75 76 | 2 15 45 18 65 7 37 | 4 3 8 9 13 44 58 47 | 16 51 64 70 | 10 34 53 11 24 20 22 21 23 | 55 56 57 12 | 36 46 38 49  50 71 14 68 | 30 29 54 32 31 33 | 25 17 26 60 61 | 40 41 42 28 35"); // 27 52 banned https://wiki.geogebra.org/en/Reference:Toolbar
                document.getElementById("ggb-loading").style.display="none";
                if (!stepsLoaded && document.getElementById("solution-steps")) stepsOnLoad();
                problemOnLoad();
            }
            var params = {
                    "width": document.getElementById("ggb-wrapper").offsetWidth,
                    "height": document.getElementById("ggb-wrapper").offsetHeight,
                    "showToolBar": false,
                    "showAlgebraInput": false,
                    "enableLabelDrags":false,
                    "showToolBarHelp":false,
                    "useBrowserForJS":false,
                    "showMenuBar": false,
                    "enableRightClick": false,
                    "perspective": "2",
                    "appletOnLoad": appletOnLoad
                    };
            var ggbApplet = new GGBApplet(params, true);
            function insertChildAtIndex(parent, child, index) {
                if (!index) index = 0;
                if (index >= parent.children.length) {
                    parent.appendChild(child);
                } else {
                    parent.insertBefore(child, parent.children[index]);
                }
            }
            function makeSidebarMenu() {
                sm = document.getElementById("sidebar-menu");
                function addMenuItemsTo(el, items) {
                    c = 0;
                    for (it of items) {
                        li = document.createElement("li");
                        insertChildAtIndex(el, li, c);
                        c += 1;
                        if (it.catName) {
                            det = document.createElement("details");
                            det.open = true;
                            sum = document.createElement("summary");
                            sum.innerHTML = it.catName;
                            ul = document.createElement("ul");
                            det.appendChild(sum);
                            det.appendChild(ul);
                            li.appendChild(det);
                            addMenuItemsTo(ul, it.items);
                        } else {
                            a = document.createElement("a");
                            a.innerHTML = it.name;
                            //a.addEventListener("click", ()=>{
                                url = new URL(window.location.href);
                                url.searchParams.set("task", it.task);
                            //    window.location.href = url.href;
                            //});
                            a.href = url.href;
                            a.style.position="relative";
                            rating = document.createElement("div");
                            rating.classList.add("sidebar-menu-rating");
                            for (var i = 0; i < 5; i++) {
                                star = document.createElement("div");
                                star.classList.add("mask");
                                star.classList.add("mask-star-2");
                                if (i >= it.difficulty) {
                                    star.style.cssText+="--tw-bg-opacity: .2;";
                                }
                                rating.appendChild(star);
                            }
                            li.appendChild(a);
                            a.appendChild(rating);
                        }
                    }
                }
                addMenuItemsTo(sm, menuTree);
            }
            window.addEventListener("load", function() {
                confettiState = localStorage.getItem('confettiState');
                if      (confettiState == '1') document.getElementById("confetti-checkbox").checked = false;
                else if (confettiState == '2') document.getElementById("confetti-checkbox").indeterminate = true;
                else if (confettiState == '3') document.getElementById("confetti-checkbox").checked = true;
                makeSidebarMenu();
                loadSteps();
                ggbApplet.inject('ggb-element');
            });
            function toggleConfetti(cb, evt) {
                evt.preventDefault();
                confettiState = localStorage.getItem('confettiState');
                if (confettiState == '1') {
                    localStorage.setItem('confettiState', '2');
                    cb.indeterminate = true;
                } else if (confettiState == '2') {
                    localStorage.setItem('confettiState', '3');
                    cb.checked = true;
                } else {
                    localStorage.setItem('confettiState', '1');
                    cb.checked = false;
                }
            }
        </script>
    </div>
</div>
<div class="drawer-side">
<label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
    <ul class="menu menu-sm w-80 min-h-full bg-base-200 text-base-content" id="sidebar-menu">
        <!-- Sidebar content here -->
        <div class="flex-1"><div style="position:absolute;bottom:0;padding:1rem;">Powered by <a href="https://www.geogebra.org/">GeoGebraÂ®</a></div></div>
    </ul>
</div>
</div>
</body>
</html>
