<!DOCTYPE html>
<html lang="en">
<head>
    <meta name=viewport content="width=device-width,initial-scale=1">
    <meta charset="utf-8">
    <title id="title">Formular Geometry</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script src="https://www.geogebra.org/apps/deployggb.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.23/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="https://opyshna.github.io/Formular_geometry/favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        body {
            display: flex;
            flex-flow: column;
            width: 100vw;
            height: 100vh;
        }
        .full_width, .explanation, .drawer, .drawer-content, #navbar {
            min-width: 0;
            min-height: 0;
        }
        .full_width {
            flex: 1 1 auto;
            display: flex;
        }
        .half_width {
            flex: 0 0 50%;
        }
        @media (max-width: 100vh) {
            .full_width {
                flex-flow: column;
            }
            .explanation {
                order: 2;
            }
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .explanation {
            flex: 1 1 auto;
            overflow-y: auto;
        }
        #solution-steps {
            overflow: hidden;
            margin: 0;
            max-height: 0;
            transition: max-height 0.3s cubic-bezier(0.2, 1, 0.1, 1);
        }
        #navbar {
            box-shadow: 0 0 1px black;
            padding-top: 2px;
            padding-left: 2px;
            padding-bottom: 2px;
        }
        .sidebar-menu-rating {
            position: absolute;
            right: .75rem;
            top: 0;
            bottom: 0;
            display: flex;
            align-items: center;
        }
        .sidebar-menu-rating > div {
            --tw-bg-opacity: 1;
            background-color: rgb(251 146 60/var(--tw-bg-opacity));
            height: 1rem;
            width: 1rem;
        }
        #task-container > div:not(.join, #solution-steps), #solution-steps > div {
            padding: 10px;
        }
        #task-container > div > b {
            margin-right: 5px;
        }
    </style>
    <script>
        {
        var defaultMenuItem = {
            name: "_error_",
            link: "",
            difficulty: -1,
            image: ""
        };
        let ABH = {
            name: "ABH",
            link: "/?task=ABH",
            difficulty: 1,
            image: "/ABH.svg"
        };
        var menuList = [ABH];
        var menuTree = [
            {catName:"Triangle reconstruction", items:[ABH]}
        ];
        }
    </script>
</head>
<body>
<div class="drawer flex flex-1">
<input id="my-drawer" type="checkbox" class="drawer-toggle" />
<div class="drawer-content flex flex-col flex-1">
    <div class="navbar bg-base-100" id="navbar">
        <div class="flex-none">
            <label for="my-drawer" class="btn btn-square btn-ghost drawer-button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </label>
        </div>
        <div class="flex-1">
            <a class="btn btn-ghost text-xl no-animation" id="menuTitle">Formular Geometry</a>
        </div>
        <div class="flex-none">
            <div class="form-control">
                <label class="label cursor-pointer">
                    <span class="label-text">ðŸŽ‰&nbsp;</span>
                    <input type="checkbox" class="toggle" id="confetti-checkbox" onchange="toggleConfetti(this,event);"/>
                </label>
            </div>
            <label class="cursor-pointer grid place-items-center">
                <input type="checkbox" value="synthwave" class="toggle theme-controller bg-base-content row-start-1 col-start-1 col-span-2"/>
                <svg class="col-start-1 row-start-1 stroke-base-100 fill-base-100" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/></svg>
                <svg class="col-start-2 row-start-1 stroke-base-100 fill-base-100" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </label>
        </div>
    </div>

    <div class="full_width">
        <div class="half_width explanation">
            <div class="flex-col" id="task-container">

                <!--<div><b>Task:</b>reconstruct the triangle by points A, B and H</div>
                <div class="flex"><b>Given:</b><div class="flex-col">
                <div>$A,B$ - two vertices of the triangle</div>
                <div>$H$ - point of intersection of heights of the triangle</div>
                </div></div>
                <div class="flex-col" id="solution-steps" task-name="ABH" initial-command=
                "A=(2,1)\nB=(0,-1)\nH=(0,0)
                AH=Ray(A,H)\nBH=Ray(B,H)
                AB_1l=PerpendicularLine(A,BH)\nB_1=Intersect(AB_1l,BH)\nSetVisibleInView(AB_1l,1,False)\nAB_1=Ray(A,B_1)
                BA_1l=PerpendicularLine(B,AH)\nA_1=Intersect(BA_1l,AH)\nSetVisibleInView(BA_1l,1,False)\nBA_1=Ray(B,A_1)
                C=Intersect(AB_1l,BA_1l)
                ABC=Polygon(A,B,C)">
                <div objs="AH BH">1. $AH$ and $BH$</div>
                <div objs="AB_1 BA_1 A_1 B_1">2. $AB_1âŠ¥BH$ and $BA_1âŠ¥AH$</div>
                <div objs="C">3. $C=AB_1â‹ƒBA_1$</div>
                <div objs="ABC">4. $Î”ABC$</div>
                </div>-->

                <div class="join">
                    <buttton onclick="prevGG()" class="btn join-item"><div class="ssLoading" style="position: relative;"><span style="visibility: hidden;">PREV</span><span class="loading loading-spinner loading-xs"></span></div></buttton>
                    <buttton onclick="nextGG()" class="btn join-item"><div class="ssLoading" style="position: relative;"><span style="visibility: hidden;" id="confetti-source">NEXT</span><span class="loading loading-spinner loading-xs"></span></div></buttton>
                    <button class="btn btn-square join-item" onmousedown="ssMouseDown(event.clientY);event.preventDefault();" ontouchstart="ssMouseDown(event.touches[0].clientY);event.preventDefault();" style="touch-action:none;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="half_width" id="ggb-wrapper">
            <div style="position:relative;width:fit-content;height:fit-content;">
                <div id="ggb-element"></div>
                <span class="loading loading-spinner loading-lg" id="ggb-loading"></span>
                <button class="btn btn-square" onclick="appletOnClear()" fill="none" style="position:absolute;top:1px;right:1px">
                    <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-5 h-5 stroke-current" viewBox="0 0 30 30">
                        <path d="M 15 3 C 12.053086 3 9.3294211 4.0897803 7.2558594 5.8359375 A 1.0001 1.0001 0 1 0 8.5449219 7.3652344 C 10.27136 5.9113916 12.546914 5 15 5 C 20.226608 5 24.456683 8.9136179 24.951172 14 L 22 14 L 26 20 L 30 14 L 26.949219 14 C 26.441216 7.8348596 21.297943 3 15 3 z M 4.3007812 9 L 0.30078125 15 L 3 15 C 3 21.635519 8.3644809 27 15 27 C 17.946914 27 20.670579 25.91022 22.744141 24.164062 A 1.0001 1.0001 0 1 0 21.455078 22.634766 C 19.72864 24.088608 17.453086 25 15 25 C 9.4355191 25 5 20.564481 5 15 L 8.3007812 15 L 4.3007812 9 z"></path>
                    </svg>
                </button>
            </div>
        </div>


        <script>
            function fixGGB() {
                if (!GGapp) return;
                document.getElementById("ggb-wrapper").style.overflow="hidden";
                //document.getElementsByClassName("ggbTransform")[0].style.transform='';
                GGapp.setWidth(document.getElementById("ggb-wrapper").offsetWidth);
                GGapp.setHeight(document.getElementById("ggb-wrapper").offsetHeight);
                GGapp.evalCommand("SetPerspective(\"G\")");
            }
            window.addEventListener("resize", fixGGB);
            GGapp = undefined;
            stepsLoaded = false;
            confettiLaunched = false;
            if (!localStorage.getItem('confettiState')) localStorage.setItem('confettiState', '2');
            cc = 0;
            animSpeed = 200; // px/s
            function getStepsHeights() {
                heights = [0];
                steps = document.getElementById("solution-steps").children;
                for (var i = 0; i < steps.length; i++) heights.push(steps[i].offsetHeight + heights[i]);
                return heights;
            }
            function getConfetti() {
                confettiState = localStorage.getItem('confettiState');
                if ((confettiLaunched && confettiState != '3') || confettiState == '1' || (ssMove.moving && ssMove.confettiLaunched)) return;
                rect = document.getElementById("confetti-source").getBoundingClientRect();
                confetti({
                        // https://github.com/catdad/canvas-confetti?tab=readme-ov-file#options
                                particleCount: 20,
                                startVelocity: 20,
                                ticks: 50,
                                origin: {x:(rect.x+rect.width/2)/window.innerWidth, y:(rect.y+rect.height/2)/window.innerHeight},
                                disableForReducedMotion: true
                });
                confettiLaunched = true;
                ssMove.confettiLaunched = true;
            }
            function nextGG() {
                ss = document.getElementById("solution-steps");
                if (!stepsLoaded || ss.children.length <= cc) return;
                if (GGapp) for (obj of ss.children[cc].getAttribute("objs").split(" ")) GGapp.setVisible(obj, true);
                h2 = getStepsHeights()[cc+1];
                ss.style.maxHeight = h2 + "px";
                cc += 1;
                if (cc == ss.children.length) getConfetti();
            }
            function prevGG() {
                if (!stepsLoaded || cc <= 0) return;
                cc -= 1;
                ss = document.getElementById("solution-steps");
                if (GGapp) for (obj of ss.children[cc].getAttribute("objs").split(" ")) GGapp.setVisible(obj, false);
                h2 = getStepsHeights()[cc];
                ss.style.maxHeight = h2 + "px";
            }
            ssMove = {}
            function ssMouseDown(y) {
                if (!stepsLoaded) return;
                ssMove.heights = getStepsHeights();
                ss = document.getElementById("solution-steps");
                h0 = ss.offsetHeight;
                ss.style.maxHeight = ss.offsetHeight + "px";
                ss.style.transition = "none";
                rect = ss.getBoundingClientRect();
                ssMove.startY = y-rect["top"]-h0;
                ssMove.moving = true;
            }
            function ssMouseMove(y, bl) {
                if (!stepsLoaded || !ssMove.moving) return;
                if (!bl) {
                    ssMouseUp();
                    return;
                }
                ss = document.getElementById("solution-steps");
                rect = ss.getBoundingClientRect();
                h1 = Math.max(0, y-rect["top"]-ssMove.startY);
                ss.style.maxHeight = h1 + "px";
                cc1 = 0;
                for (var i = 0; i < ss.children.length; i++) {
                    mid = (heights[i]+heights[i+1])/2;
                    shouldShow = h1>mid;
                    if (GGapp) for (obj of ss.children[i].getAttribute("objs").split(" ")) GGapp.setVisible(obj, shouldShow);
                    if (shouldShow) cc1 = i+1;
                }
                cc = cc1;
                if (cc == ss.children.length) getConfetti();
                else ssMove.confettiLaunched = false;
            }
            function ssMouseUp() {
                if (!stepsLoaded || !ssMove.moving) return;
                ss = document.getElementById("solution-steps");
                ss.style.transition = "";
                h0 = ss.offsetHeight;
                h2 = getStepsHeights()[cc];
                ss.style.maxHeight = h2 + "px";
                ssMove.moving = false;
            }
            window.addEventListener("mousemove", (event)=>ssMouseMove(event.clientY, event.buttons & 1));
            window.addEventListener("mouseup", ssMouseUp);
            document.body.addEventListener("touchstart", ()=>{})
            window.addEventListener("touchmove", (event)=>ssMouseMove(event.touches[0].clientY, true));
            window.addEventListener("touchend", ssMouseUp);
            window.addEventListener("touchcancel", ssMouseUp);
            function loadSteps() {
                sc = document.getElementById("task-container");
                ifrm = document.createElement("iframe");
                ifrm.setAttribute("onload", "this.insertAdjacentHTML('afterend', (this.contentDocument.body||this.contentDocument).innerHTML);this.remove();stepsOnLoad();");
                url = new URL(window.location.href);
                ifrm.setAttribute("src", url.searchParams.get("task"));
                ifrm.style.display = "none";
                sc.insertBefore(ifrm, sc.firstChild);
            }
            function stepsOnLoad() {
                MathJax.Hub.Typeset()
                title = document.getElementById("title");
                title.innerHTML = document.getElementById("solution-steps").getAttribute("task-name") + " - " + title.innerHTML;
                for (el of document.getElementsByClassName("ssLoading")) {
                    el.children[0].style.visibility="";
                    el.children[1].style.display="none";
                }
                stepsLoaded = true;
                problemOnLoad();
            }
            function appletOnClear() {
                if (GGapp && stepsLoaded) GGapp.evalCommand(document.getElementById("solution-steps").getAttribute("initial-command").replaceAll("\\n", "\n"));
            }
            function problemOnLoad() {
                if (!stepsLoaded || !GGapp) return;
                ss = document.getElementById("solution-steps");
                GGapp.evalCommand(ss.getAttribute("initial-command").replaceAll("\\n", "\n"));
                for (var i = cc; i < ss.children.length; i++) for (obj of ss.children[i].getAttribute("objs").split(" ")) GGapp.setVisible(obj, false);
            }
            function appletOnLoad(app) {
                GGapp = app;
                app.evalCommand("SetPerspective(\"G\")");
                document.getElementById("ggb-loading").style.display="none";
                if (!stepsLoaded && document.getElementById("solution-steps")) stepsOnLoad();
                problemOnLoad();
            }
            var params = {
                    "appName": "geometry",
                    "width": document.getElementById("ggb-wrapper").offsetWidth,
                    "height": document.getElementById("ggb-wrapper").offsetHeight,
                    "showToolBar": false,
                    "showAlgebraInput": false,
                    "enableLabelDrags":false,
                    "showToolBarHelp":false,
                    "useBrowserForJS":false,
                    "showMenuBar": false,
                    "appletOnLoad": appletOnLoad
                    };
            var ggbApplet = new GGBApplet(params, true);
            function insertChildAtIndex(parent, child, index) {
                if (!index) index = 0;
                if (index >= parent.children.length) {
                    parent.appendChild(child);
                } else {
                    parent.insertBefore(child, parent.children[index]);
                }
            }
            function makeSidebarMenu() {
                sm = document.getElementById("sidebar-menu");
                function addMenuItemsTo(el, items) {
                    c = 0;
                    for (it of items) {
                        li = document.createElement("li");
                        insertChildAtIndex(el, li, c);
                        c += 1;
                        if (it.catName) {
                            det = document.createElement("details");
                            det.open = true;
                            sum = document.createElement("summary");
                            sum.innerHTML = it.catName;
                            ul = document.createElement("ul");
                            det.appendChild(sum);
                            det.appendChild(ul);
                            li.appendChild(det);
                            addMenuItemsTo(ul, it.items);
                        } else {
                            a = document.createElement("a");
                            a.innerHTML = it.name;
                            a.href = it.link;
                            a.style.position="relative";
                            rating = document.createElement("div");
                            rating.classList.add("sidebar-menu-rating");
                            for (var i = 0; i < 5; i++) {
                                star = document.createElement("div");
                                star.classList.add("mask");
                                star.classList.add("mask-star-2");
                                if (i >= it.difficulty) {
                                    star.style.cssText+="--tw-bg-opacity: .2;";
                                }
                                rating.appendChild(star);
                            }
                            li.appendChild(a);
                            a.appendChild(rating);
                        }
                    }
                }
                addMenuItemsTo(sm, menuTree);
            }
            window.addEventListener("load", function() {
                confettiState = localStorage.getItem('confettiState');
                if      (confettiState == '1') document.getElementById("confetti-checkbox").checked = false;
                else if (confettiState == '2') document.getElementById("confetti-checkbox").indeterminate = true;
                else if (confettiState == '3') document.getElementById("confetti-checkbox").checked = true;
                makeSidebarMenu();
                loadSteps();
                ggbApplet.inject('ggb-element');
            });
            function toggleConfetti(cb, evt) {
                evt.preventDefault();
                confettiState = localStorage.getItem('confettiState');
                if (confettiState == '1') {
                    localStorage.setItem('confettiState', '2');
                    cb.indeterminate = true;
                } else if (confettiState == '2') {
                    localStorage.setItem('confettiState', '3');
                    cb.checked = true;
                } else {
                    localStorage.setItem('confettiState', '1');
                    cb.checked = false;
                }
            }
        </script>
    </div>
</div>
<div class="drawer-side">
<label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
    <ul class="menu menu-sm w-80 min-h-full bg-base-200 text-base-content" id="sidebar-menu">
        <!-- Sidebar content here -->
        <div class="flex-1"><div style="position:absolute;bottom:0;padding:1rem;">Powered by <a href="https://www.geogebra.org/">GeoGebraÂ®</a></div></div>
    </ul>
</div>
</div>
</body>
</html>
